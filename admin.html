<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Paneli</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.9)),
                url('https://images.unsplash.com/photo-1483664852095-d6cc6870702d?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            min-height: 100vh;
            color: #fff;
            display: none;
            padding: 20px;
        }

        /* Your existing styles remain the same */
        /* ... */

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
                padding: 0.5rem;
            }

            .users-table {
                display: block;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .stat-card {
                margin: 0.5rem 0;
            }

            .action-btn {
                padding: 8px 16px;
                margin: 2px;
                display: inline-block;
                width: auto;
            }
        }

        /* Add touch-friendly styles */
        @media (hover: none) {
            .action-btn:active {
                background: rgba(255, 255, 255, 0.2);
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <!-- Your existing HTML structure remains the same -->
    <script>
        // Improved admin check
        function checkAdminAuth() {
            const isAdmin = sessionStorage.getItem('isAdmin');
            const username = sessionStorage.getItem('username');
            
            if (!isAdmin || username !== 'admin') {
                window.location.href = 'login.html';
                return false;
            }
            return true;
        }

        window.onload = function() {
            if (checkAdminAuth()) {
                document.body.style.display = 'block';
                updateStats();
                updateClock();
            }
        }

        // Improved user management
        function getUsers() {
            return JSON.parse(localStorage.getItem('users')) || [];
        }

        function saveUsers(users) {
            localStorage.setItem('users', JSON.stringify(users));
        }

        function updateStats() {
            const users = getUsers();
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());

            const totalUsers = users.length;
            const onlineUsers = users.filter(user => user.isOnline).length;
            const todayRegistrations = users.filter(user => {
                const regDate = new Date(user.registerDate);
                return regDate >= today;
            }).length;

            document.getElementById('totalUsers').textContent = totalUsers;
            document.getElementById('onlineUsers').textContent = onlineUsers;
            document.getElementById('todayRegistrations').textContent = todayRegistrations;

            updateUsersList(users);
        }

        function updateUsersList(users) {
            const usersList = document.getElementById('usersList');
            usersList.innerHTML = '';

            users.forEach((user, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.username}</td>
                    <td>${user.email}</td>
                    <td>${user.password}</td>
                    <td>${new Date(user.registerDate).toLocaleString('tr-TR')}</td>
                    <td>${user.lastLogin ? new Date(user.lastLogin).toLocaleString('tr-TR') : 'Hiç giriş yapılmadı'}</td>
                    <td>
                        <span class="online-status ${user.isOnline ? 'online' : 'offline'}"></span>
                        ${user.isOnline ? 'Online' : 'Offline'}
                    </td>
                    <td>
                        <button class="action-btn" onclick="editUser(${index})">Düzenle</button>
                        <button class="action-btn delete-btn" onclick="deleteUser(${index})">Sil</button>
                    </td>
                `;
                usersList.appendChild(row);
            });
        }

        function deleteUser(index) {
            if(confirm('Bu kullanıcıyı silmek istediğinizden emin misiniz?')) {
                let users = getUsers();
                users.splice(index, 1);
                saveUsers(users);
                updateStats();
            }
        }

        function editUser(index) {
            let users = getUsers();
            const user = users[index];

            const newUsername = prompt('Yeni kullanıcı adı:', user.username);
            if(!newUsername || !newUsername.trim()) return;

            const newEmail = prompt('Yeni e-posta:', user.email);
            if(!newEmail || !newEmail.trim()) return;

            const newPassword = prompt('Yeni şifre (boş bırakılırsa değişmez):', '');

            users[index] = {
                ...user,
                username: newUsername.trim(),
                email: newEmail.trim(),
                password: newPassword ? newPassword.trim() : user.password,
                lastModified: new Date().toISOString()
            };

            saveUsers(users);
            updateStats();
        }

        function updateClock() {
            const now = new Date();
            document.getElementById('clock').textContent = now.toLocaleTimeString('tr-TR');
        }

        function logout() {
            sessionStorage.clear();
            window.location.href = 'login.html';
        }

        // Auto-update
        setInterval(updateClock, 1000);
        setInterval(updateStats, 30000);

        // Handle visibility change
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                updateStats();
            }
        });
    </script>
</body>
</html>
